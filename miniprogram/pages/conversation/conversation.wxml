<view class="container">
  <!-- 消息列表 -->
  <scroll-view scroll-y class="message-list">
    <view wx:for="{{messages}}" wx:key="index" class="message">
      <view class="message-header">
        <text class="message-time">{{item.time}}</text>
      </view>
      <view class="message-content">
        <text>{{item.content}}</text>
      </view>
      <view class="analysis" wx:if="{{item.analysis}}">
        <view class="analysis-item">
          <text class="analysis-label">情绪:</text>
          <text class="analysis-value">{{item.analysis.mood}}</text>
        </view>
        <view class="analysis-item">
          <text class="analysis-label">语气:</text>
          <text class="analysis-value">{{item.analysis.tone}}</text>
        </view>
        <view class="analysis-item">
          <text class="analysis-label">潜在意图:</text>
          <text class="analysis-value">{{item.analysis.underlying_meaning}}</text>
        </view>
        <view class="analysis-item">
          <text class="analysis-label">建议回复:</text>
          <text class="analysis-value">{{item.analysis.suggestion}}</text>
        </view>
      </view>
      <view class="analysis-loading" wx:if="{{!item.analysis && index === messages.length - 1 && isAnalyzing}}">
        <text>分析中...</text>
      </view>
    </view>
  </scroll-view>
  
  <!-- 输入区域 -->
  <view class="input-area">
    <view class="input-box">
      <input 
        class="text-input" 
        value="{{inputText}}" 
        bindinput="onInputChange" 
        placeholder="输入消息..." 
        confirm-type="send"
        bindconfirm="sendMessage"
      />
      <view class="input-actions">
        <button 
          class="record-btn {{isRecording ? 'recording' : ''}}" 
          bindtouchstart="startRecording" 
          bindtouchend="stopRecording"
        >
          <text>{{isRecording ? '松开结束' : '按住说话'}}</text>
        </button>
        <button class="send-btn" bindtap="sendMessage">发送</button>
      </view>
    </view>
  </view>
  
  <!-- 当前分析结果 -->
  <view class="current-analysis" wx:if="{{currentAnalysis}}">
    <view class="current-analysis-header">
      <text>最新分析结果</text>
    </view>
    <view class="current-analysis-content">
      <view class="analysis-item">
        <text class="analysis-label">情绪:</text>
        <text class="analysis-value">{{currentAnalysis.mood}}</text>
      </view>
      <view class="analysis-item">
        <text class="analysis-label">语气:</text>
        <text class="analysis-value">{{currentAnalysis.tone}}</text>
      </view>
      <view class="analysis-item">
        <text class="analysis-label">潜在意图:</text>
        <text class="analysis-value">{{currentAnalysis.underlying_meaning}}</text>
      </view>
      <view class="analysis-item">
        <text class="analysis-label">建议回复:</text>
        <text class="analysis-value">{{currentAnalysis.suggestion}}</text>
      </view>
    </view>
  </view>
</view>